<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¦­å‘†èŒæé¾™ğŸ¦­ä¼˜é€‰å·¥å…·</title>
  <meta name="description" content="ä¼˜é€‰CloudFlare CDNçš„IPåœ°å€ï¼Œè·å–æœ€ä½³ç½‘ç»œä½“éªŒï¼Œç”±å‘†èŒæé¾™æä¾›">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸš€</text></svg>">
  <style>
    /* åŸºç¡€æ ·å¼ */
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f0f2f5; }
    
    /* 3Dç«‹ä½“æ•ˆæœå®¹å™¨ */
    .container { 
      max-width: 800px; 
      margin: 0 auto; 
      background: white; 
      padding: 20px; 
      border-radius: 12px; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.1), 
                  0 1px 8px rgba(0,0,0,0.07),
                  0 20px 30px rgba(255,255,255,0.6) inset; 
      transform: translateZ(0);
      position: relative;
      overflow: hidden;
    }
    
    /* æ ‡é¢˜3Dæ•ˆæœ */
    h1 { 
      text-align: center; 
      color: #333; 
      text-shadow: 1px 1px 0 #fff, 2px 2px 0 rgba(0,0,0,0.1);
      position: relative;
    }
    
    .description { 
      text-align: center; 
      color: #666; 
      margin-bottom: 20px; 
    }
    
    /* æ§åˆ¶åŒºåŸŸ3Dæ•ˆæœ */
    .controls { 
      display: flex; 
      justify-content: center; 
      gap: 10px; 
      margin-bottom: 20px; 
      align-items: center; 
      flex-wrap: wrap; 
    }
    
    /* æŒ‰é’®3Dæ•ˆæœ */
    .btn { 
      padding: 10px 20px; 
      background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); 
      color: #333; 
      border: none; 
      border-radius: 8px; 
      cursor: pointer; 
      font-size: 16px; 
      font-weight: 600;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1),
                  0 1px 3px rgba(0,0,0,0.08),
                  0 1px 0 rgba(255,255,255,0.7) inset;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(0,0,0,0.12),
                  0 3px 6px rgba(0,0,0,0.08),
                  0 1px 0 rgba(255,255,255,0.7) inset;
    }
    
    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1),
                  0 1px 2px rgba(0,0,0,0.08),
                  0 1px 0 rgba(255,255,255,0.7) inset;
    }
    
    .btn:before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
                  rgba(255,255,255,0) 0%, 
                  rgba(255,255,255,0.3) 50%, 
                  rgba(255,255,255,0) 100%);
      transition: all 0.6s ease;
    }
    
    .btn:hover:before {
      left: 100%;
    }
    
    .btn:disabled { 
      background: linear-gradient(135deg, #e0e0e0 0%, #d0d0d0 100%); 
      cursor: not-allowed; 
      box-shadow: none;
      transform: none;
    }
    
    /* è®¾ç½®åŒºåŸŸ3Dæ•ˆæœ */
    .settings { 
      display: flex; 
      flex-wrap: wrap; 
      justify-content: center; 
      margin-top: 10px; 
      width: 100%; 
    }
    
    .setting-item { 
      display: flex; 
      align-items: center; 
      margin: 5px 10px; 
      background: white;
      padding: 8px 12px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05),
                  0 1px 2px rgba(0,0,0,0.04);
    }
    
    .setting-item label { 
      margin-right: 8px; 
      white-space: nowrap; 
      font-weight: 500;
      color: #444;
    }
    
    .setting-item input { 
      width: 80px; 
      padding: 6px; 
      border: 1px solid #e0e0e0; 
      border-radius: 6px; 
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
      transition: all 0.2s ease;
    }
    
    .setting-item input:focus {
      outline: none;
      border-color: #a0c8ff;
      box-shadow: 0 0 0 3px rgba(66,133,244,0.15), 
                  inset 0 1px 3px rgba(0,0,0,0.05);
    }
    
    /* è¿›åº¦æ¡3Dæ•ˆæœ */
    .progress-container { 
      height: 30px; 
      background: #f5f5f5; 
      border-radius: 8px; 
      margin-bottom: 20px; 
      position: relative; 
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .progress-bar { 
      height: 100%; 
      width: 0; 
      background: linear-gradient(135deg, #4285f4 0%, #34a853 100%); 
      border-radius: 8px; 
      transition: width 0.3s; 
      box-shadow: 0 1px 0 rgba(255,255,255,0.3) inset;
    }
    
    .progress-text { 
      position: absolute; 
      top: 0; 
      left: 0; 
      right: 0; 
      text-align: center; 
      line-height: 30px; 
      color: #333; 
      font-weight: 500;
      text-shadow: 0 1px 0 rgba(255,255,255,0.5);
      z-index: 1;
    }
    
    /* ç»“æœåŒºåŸŸ3Dæ•ˆæœ */
    .results { 
      display: none; 
      background: white;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05),
                  0 1px 5px rgba(0,0,0,0.03);
      padding: 15px;
      position: relative;
      overflow: hidden;
    }
    
    /* æ ‡ç­¾æŒ‰é’®3Dæ•ˆæœ */
    .tab-btn { 
      padding: 8px 15px; 
      background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%); 
      border: none; 
      border-radius: 8px; 
      cursor: pointer; 
      font-weight: 500;
      box-shadow: 0 2px 5px rgba(0,0,0,0.06),
                  0 1px 2px rgba(0,0,0,0.04);
      transition: all 0.2s ease;
    }
    
    .tab-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.08),
                  0 2px 4px rgba(0,0,0,0.06);
    }
    
    .tab-btn.active { 
      background: linear-gradient(135deg, #4285f4 0%, #5c9aff 100%); 
      color: white; 
      box-shadow: 0 2px 5px rgba(66,133,244,0.3),
                  0 1px 2px rgba(66,133,244,0.2);
    }
    
    /* è¡¨æ ¼3Dæ•ˆæœ */
    table { 
      width: 100%; 
      border-collapse: separate; 
      border-spacing: 0;
      margin-top: 10px;
    }
    
    th, td { 
      padding: 12px; 
      text-align: left; 
      border-bottom: 1px solid #f0f0f0; 
    }
    
    th { 
      background: linear-gradient(135deg, #f8f9fa 0%, #f0f2f5 100%); 
      font-weight: 600;
      color: #444;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 1px 0 #e0e0e0;
    }
    
    tr {
      transition: all 0.2s ease;
    }
    
    tr:hover {
      background-color: #f9f9f9;
      transform: translateZ(5px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.03);
    }
    
    /* è´¨é‡æŒ‡ç¤ºå™¨3Dæ•ˆæœ */
    .excellent { 
      background: linear-gradient(135deg, #e8f5e9 0%, #d7eeda 100%); 
    }
    
    .good { 
      background: linear-gradient(135deg, #f0f4c3 0%, #e6ebb4 100%); 
    }
    
    .average { 
      background: linear-gradient(135deg, #fff8e1 0%, #ffefcc 100%); 
    }
    
    .poor { 
      background: linear-gradient(135deg, #ffebee 0%, #ffdde0 100%); 
    }
    
    /* IPç±»å‹æ ‡ç­¾3Dæ•ˆæœ */
    .ip-type {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: bold;
      text-align: center;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08),
                  0 1px 0 rgba(255,255,255,0.5) inset;
      position: relative;
      transform: translateZ(0);
    }
    
    .ipv4 {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      color: #1565c0;
      border: 1px solid rgba(187,222,251,0.5);
    }
    
    .ipv6 {
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      color: #2e7d32;
      border: 1px solid rgba(200,230,201,0.5);
    }
    
    /* å»¶è¿Ÿè¯¦æƒ…æ ·å¼ */
    .latency-main {
      font-weight: bold;
      font-size: 14px;
      margin-bottom: 4px;
    }
    
    .latency-details {
      display: flex;
      flex-direction: column;
      font-size: 11px;
      color: #666;
    }
    
    .latency-details small {
      line-height: 1.4;
    }
    
    /* è¿‡æ»¤å®¹å™¨3Dæ•ˆæœ */
    .filter-container {
      margin-bottom: 20px;
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      padding: 18px;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05),
                  0 1px 5px rgba(0,0,0,0.03);
      position: relative;
      overflow: hidden;
    }
    
    /* è¿‡æ»¤éƒ¨åˆ†3Dæ•ˆæœ */
    .filter-section {
      margin-bottom: 15px;
      position: relative;
    }
    
    .filter-section h3 {
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 16px;
      color: #333;
      text-shadow: 0 1px 0 #fff;
      position: relative;
    }
    
    .filter-section h3:after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 0;
      width: 40px;
      height: 2px;
      background: linear-gradient(90deg, #4285f4, transparent);
    }
    
    /* è¿‡æ»¤ç»„3Dæ•ˆæœ */
    .filter-groups {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      max-height: 300px;
      overflow-y: auto;
      padding-right: 10px;
      scrollbar-width: thin;
      scrollbar-color: #ccc #f5f5f5;
    }
    
    .filter-groups::-webkit-scrollbar {
      width: 6px;
    }
    
    .filter-groups::-webkit-scrollbar-track {
      background: #f5f5f5;
      border-radius: 10px;
    }
    
    .filter-groups::-webkit-scrollbar-thumb {
      background: #ccc;
      border-radius: 10px;
    }
    
    .filter-group {
      flex: 1;
      min-width: 200px;
      background: white;
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04),
                  0 1px 3px rgba(0,0,0,0.02);
      position: relative;
      overflow: hidden;
    }
    
    .filter-group h4 {
      margin: 0 0 10px 0;
      font-size: 14px;
      color: #444;
      border-bottom: 1px solid #eee;
      padding-bottom: 8px;
      position: sticky;
      top: 0;
      background: white;
      z-index: 1;
      text-shadow: 0 1px 0 #fff;
    }
    
    /* é€‰é¡¹æŒ‰é’®3Dæ•ˆæœ */
    .select-btn {
      padding: 6px 12px;
      font-size: 14px;
      background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
      color: #333;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06),
                  0 1px 2px rgba(0,0,0,0.04);
      transition: all 0.2s ease;
    }
    
    .select-btn:hover {
      background: linear-gradient(135deg, #f0f0f0 0%, #e5e5e5 100%);
      transform: translateY(-1px);
      box-shadow: 0 3px 6px rgba(0,0,0,0.08),
                  0 1px 3px rgba(0,0,0,0.06);
    }
    
    .select-btn:active {
      transform: translateY(1px);
      box-shadow: 0 1px 2px rgba(0,0,0,0.04);
    }
    
    /* é¡µè„š3Dæ•ˆæœ */
    .footer {
      margin-top: 30px;
      text-align: center;
      font-size: 14px;
      color: #666;
      padding: 15px;
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05),
                  0 1px 3px rgba(0,0,0,0.02);
      position: relative;
      overflow: hidden;
    }
    
    /* æŒ‡å¯¼è¯´æ˜3Dæ•ˆæœ */
    .instructions {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      padding: 18px;
      border-radius: 12px;
      margin-bottom: 20px;
      font-size: 14px;
      line-height: 1.5;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05),
                  0 1px 5px rgba(0,0,0,0.03);
      position: relative;
      overflow: hidden;
    }
    
    .instructions h3 {
      margin-top: 0;
      margin-bottom: 12px;
      color: #333;
      text-shadow: 0 1px 0 #fff;
      position: relative;
    }
    
    .instructions h3:after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 0;
      width: 40px;
      height: 2px;
      background: linear-gradient(90deg, #4285f4, transparent);
    }
    
    /* ä¸Šä¼ éƒ¨åˆ†3Dæ•ˆæœ */
    .upload-section {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      padding: 18px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05),
                  0 1px 5px rgba(0,0,0,0.03);
      position: relative;
      overflow: hidden;
    }
    
    .upload-btn {
      padding: 10px 20px;
      background: linear-gradient(135deg, #4285f4 0%, #5c9aff 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
      box-shadow: 0 4px 6px rgba(66,133,244,0.3),
                  0 1px 3px rgba(66,133,244,0.2),
                  0 1px 0 rgba(255,255,255,0.1) inset;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    
    .upload-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(66,133,244,0.4),
                  0 3px 6px rgba(66,133,244,0.3),
                  0 1px 0 rgba(255,255,255,0.1) inset;
    }
    
    .upload-btn:before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, 
                  rgba(255,255,255,0) 0%, 
                  rgba(255,255,255,0.3) 50%, 
                  rgba(255,255,255,0) 100%);
      transition: all 0.6s ease;
    }
    
    .upload-btn:hover:before {
      left: 100%;
    }
    
    /* æ–‡ä»¶è¾“å…¥3Dæ•ˆæœ */
    .file-input {
      margin-bottom: 10px;
      position: relative;
    }
    
    /* æ ‡ç­¾é¡µ3Dæ•ˆæœ */
    .tabs {
      display: flex;
      margin-bottom: 20px;
      justify-content: center;
      position: relative;
      z-index: 1;
    }
    
    .tab {
      padding: 10px 20px;
      background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
      cursor: pointer;
      font-weight: 500;
      border-radius: 8px;
      margin: 0 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.06),
                  0 1px 2px rgba(0,0,0,0.04);
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    
    .tab:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.08),
                  0 2px 4px rgba(0,0,0,0.06);
    }
    
    .tab.active {
      background: linear-gradient(135deg, #4285f4 0%, #5c9aff 100%);
      color: white;
      box-shadow: 0 2px 5px rgba(66,133,244,0.3),
                  0 1px 2px rgba(66,133,244,0.2);
    }
    
    /* æ·»åŠ ä¸€äº›å…¨å±€3Dæ•ˆæœ */
    .container:before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
      pointer-events: none;
      z-index: -1;
    }
    
    /* æ·»åŠ ä¸€äº›åŠ¨ç”»æ•ˆæœ */
    @keyframes float {
      0% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-5px);
      }
      100% {
        transform: translateY(0px);
      }
    }
    
    .container {
      animation: float 6s ease-in-out infinite;
    }
    
    /* é€‚é…ç§»åŠ¨è®¾å¤‡ */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
        margin: 10px;
      }
      
      .controls {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
        margin-bottom: 10px;
      }
      
      .filter-group {
        min-width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¦­å‘†èŒæé¾™ğŸ¦­ä¼˜é€‰å·¥å…·</h1>
    <p class="description">ä¼˜é€‰CloudFlare CDNçš„IPåœ°å€ï¼Œè·å–æœ€ä½³ç½‘ç»œä½“éªŒ</p>
    
    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <div class="tabs">
      <div class="tab active" data-tab="test">ä¼˜é€‰IP</div>
      <div class="tab" data-tab="upload">å¯¼å…¥ä¼˜é€‰IP</div>
    </div>
    
    <!-- ä¼˜é€‰IPæ ‡ç­¾é¡µ -->
    <div id="test-tab" class="tab-content active">
      <div class="controls">
        <button id="start-test" class="btn">å¼€å§‹ä¼˜é€‰</button>
        <button id="export-results" class="btn" disabled>å¯¼å‡ºç»“æœ</button>
        <div class="settings">
          <div class="setting-item">
            <label for="max-latency">å»¶è¿Ÿé˜ˆå€¼(ms):</label>
            <input type="number" id="max-latency" min="50" max="1000" value="200" placeholder="é»˜è®¤200ms">
          </div>
          <div class="setting-item">
            <label for="max-ip-count">æµ‹è¯•IPæ•°é‡:</label>
            <input type="number" id="max-ip-count" min="50" max="2000" value="500" placeholder="é»˜è®¤500ä¸ª">
          </div>
          <label class="auto-test-checkbox">
            <input type="checkbox" id="auto-test">
            <span>é¡µé¢åŠ è½½åè‡ªåŠ¨å¼€å§‹ä¼˜é€‰</span>
          </label>
        </div>
      </div>
      
      <div class="instructions">
        <h3>ä½¿ç”¨è¯´æ˜</h3>
        <ul>
          <li>ç‚¹å‡»"å¼€å§‹ä¼˜é€‰"æŒ‰é’®å¼€å§‹ä¼˜é€‰IPåœ°å€</li>
          <li>ä¼˜é€‰è¿‡ç¨‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…</li>
          <li>ä¼˜é€‰å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ç­›é€‰å™¨é€‰æ‹©æŸ¥çœ‹ä¸åŒå›½å®¶/åœ°åŒºå’ŒIPç±»å‹</li>
          <li>å¯ä»¥é€‰æ‹©éœ€è¦æµ‹è¯•çš„ç«¯å£ç±»å‹ï¼ˆ80ç³»å’Œ443ç³»ï¼‰</li>
          <li>æ¯ä¸ªå›½å®¶/åœ°åŒºé»˜è®¤ä¼šä¼˜é€‰å‡º10ä¸ªæœ€ä½³IPåœ°å€ï¼Œå¯è‡ªå®šä¹‰æ•°é‡</li>
          <li>ç»“æœå°†æŒ‰ç…§å»¶è¿Ÿä»ä½åˆ°é«˜æ’åºæ˜¾ç¤º</li>
          <li>å»¶è¿Ÿä¿¡æ¯åŒ…å«æ€»å»¶è¿Ÿã€TCPè¿æ¥å»¶è¿Ÿå’ŒHTTPå“åº”å»¶è¿Ÿ</li>
          <li>TCPå»¶è¿Ÿä¸»è¦åæ˜ ç½‘ç»œè·ç¦»ï¼ŒHTTPå»¶è¿Ÿåæ˜ æœåŠ¡å™¨å¤„ç†èƒ½åŠ›</li>
          <li>ç³»ç»Ÿæ ¹æ®ç»¼åˆå»¶è¿Ÿè‡ªåŠ¨ä¼°ç®—IPçš„åœ°ç†ä½ç½®</li>
          <li>å¯ä»¥ä½¿ç”¨æœç´¢æ¡†å¿«é€ŸæŸ¥æ‰¾ç‰¹å®šå›½å®¶/åœ°åŒº</li>
          <li>å¯ä»¥æŒ‰å¤§æ´²ç­›é€‰æŸ¥çœ‹ç‰¹å®šåŒºåŸŸçš„ä¼˜é€‰ç»“æœ</li>
          <li>ç‚¹å‡»"å¯¼å‡ºç»“æœ"å¯å°†ä¼˜é€‰IPä¿å­˜ä¸ºæ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«ç«¯å£ä¿¡æ¯</li>
          <li>ä¼˜é€‰IPå¯ç”¨äºè‡ªå®šä¹‰åŠ é€ŸæœåŠ¡é…ç½®</li>
          <li>å»¶è¿Ÿé˜ˆå€¼é»˜è®¤ä¸º200msï¼Œå¯æ ¹æ®éœ€è¦è‡ªè¡Œè°ƒæ•´</li>
          <li>æ”¯æŒå¤šé€‰å›½å®¶/åœ°åŒºå’ŒIPç±»å‹ï¼Œå¯åŒæ—¶æŸ¥çœ‹å¤šä¸ªå›½å®¶çš„ä¼˜é€‰ç»“æœ</li>
        </ul>
      </div>
      
      <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
        <div class="progress-text" id="progress-text">å‡†å¤‡å°±ç»ª</div>
      </div>
      
      <div class="results" id="results">
        <h2>ä¼˜é€‰ç»“æœ (<span id="result-count">0</span>)</h2>
        
        <div id="filters" class="filter-container">
          <!-- ç­›é€‰å™¨å°†é€šè¿‡JSæ·»åŠ  -->
        </div>
        
        <div class="result-content" id="result-content">
          <table id="result-table">
            <thead>
              <tr>
                <th>IPåœ°å€</th>
                <th>IPç±»å‹</th>
                <th>å»¶è¿Ÿä¿¡æ¯</th>
                <th>åŒºåŸŸ</th>
                <th>å¯ç”¨ç«¯å£</th>
              </tr>
            </thead>
            <tbody id="result-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- å¯¼å…¥ä¼˜é€‰IPæ ‡ç­¾é¡µ -->
    <div id="upload-tab" class="tab-content">
      <div class="upload-section">
        <h3>å¯¼å…¥ä¼˜é€‰IPæ–‡ä»¶</h3>
        <p>æ‚¨å¯ä»¥å¯¼å…¥ä¹‹å‰å¯¼å‡ºçš„ä¼˜é€‰IPæ–‡ä»¶ï¼Œæˆ–è€…å…¶ä»–æ¥æºçš„ä¼˜é€‰IPæ–‡ä»¶ã€‚æ–‡ä»¶æ ¼å¼åº”åŒ…å«æŒ‰åœ°åŒºåˆ†ç±»çš„IPåœ°å€ï¼Œä¾‹å¦‚ï¼š</p>
        <pre>
# HK åœ°åŒº
104.16.25.4 # 80ç³»: 80,8080, 443ç³»: 443,2053
104.16.124.96 # 80ç³»: 80, 443ç³»: 443,8443

# JP åœ°åŒº
104.16.175.31 # 443ç³»: 443,2053,8443
        </pre>
        
        <form id="uploadForm" class="upload-form">
          <div class="file-input">
            <input type="file" id="ipFile" name="ipFile" accept=".txt">
          </div>
          <button type="submit" class="upload-btn">å¯¼å…¥å¹¶è§£æ</button>
        </form>
        
        <div id="uploadStatus" class="upload-status"></div>
        <div id="uploadResults"></div>
      </div>
    </div>
  </div>
  
  <div class="footer">
    <p>å‘†èŒæé¾™ä¼˜é€‰å·¥å…· &copy; 2025</p>
  </div>
  
  <!-- å†…è”IPåˆ—è¡¨æ•°æ® -->
  <script>
    // å†…è”IPv4å’ŒIPv6åˆ—è¡¨ï¼Œé¿å…ç½‘ç»œè¯·æ±‚
    const INLINE_IPV4_LIST = [
      "104.16.0.0/24", "104.16.1.0/24", "104.16.2.0/24", "104.16.3.0/24", "104.16.4.0/24",
      "104.16.5.0/24", "104.16.6.0/24", "104.16.7.0/24", "104.16.8.0/24", "104.16.9.0/24",
      "104.16.10.0/24", "104.16.11.0/24", "104.16.12.0/24", "104.16.13.0/24", "104.16.14.0/24",
      "104.16.15.0/24", "104.16.16.0/24", "104.16.17.0/24", "104.16.18.0/24", "104.16.19.0/24",
      "104.16.20.0/24", "104.16.21.0/24", "104.16.22.0/24", "104.16.23.0/24", "104.16.24.0/24",
      "104.16.25.0/24", "104.16.26.0/24", "104.16.27.0/24", "104.16.28.0/24", "104.16.29.0/24",
      "104.16.30.0/24", "104.16.31.0/24", "104.16.32.0/24", "104.16.33.0/24", "104.16.34.0/24",
      "104.16.35.0/24", "104.16.36.0/24", "104.16.37.0/24", "104.16.38.0/24", "104.16.39.0/24",
      "104.16.40.0/24", "104.16.41.0/24", "104.16.42.0/24", "104.16.43.0/24", "104.16.44.0/24",
      "104.16.45.0/24", "104.16.46.0/24", "104.16.47.0/24", "104.16.48.0/24", "104.16.49.0/24",
      "104.16.50.0/24", "104.16.51.0/24", "104.16.52.0/24", "104.16.53.0/24", "104.16.54.0/24",
      "104.16.55.0/24", "104.16.56.0/24", "104.16.57.0/24", "104.16.58.0/24", "104.16.59.0/24",
      "104.16.60.0/24", "104.16.61.0/24", "104.16.62.0/24", "104.16.63.0/24", "104.16.64.0/24",
      "104.16.65.0/24", "104.16.66.0/24", "104.16.67.0/24", "104.16.68.0/24", "104.16.69.0/24",
      "104.16.70.0/24", "104.16.71.0/24", "104.16.72.0/24", "104.16.73.0/24", "104.16.74.0/24",
      "104.16.75.0/24", "104.16.76.0/24", "104.16.77.0/24", "104.16.78.0/24", "104.16.79.0/24",
      "104.16.80.0/24", "104.16.81.0/24", "104.16.82.0/24", "104.16.83.0/24", "104.16.84.0/24",
      "104.16.85.0/24", "104.16.86.0/24", "104.16.87.0/24", "104.16.88.0/24", "104.16.89.0/24",
      "104.16.90.0/24", "104.16.91.0/24", "104.16.92.0/24", "104.16.93.0/24", "104.16.94.0/24",
      "104.16.95.0/24", "104.16.96.0/24", "104.16.97.0/24", "104.16.98.0/24", "104.16.99.0/24",
      "104.16.100.0/24", "104.16.101.0/24", "104.16.102.0/24", "104.16.103.0/24", "104.16.104.0/24"
    ];
    
    const INLINE_IPV6_LIST = [
      "2606:4700:10::6816:0/112", "2606:4700:10::6816:100/112", "2606:4700:10::6816:200/112",
      "2606:4700:10::6816:300/112", "2606:4700:10::6816:400/112", "2606:4700:10::6816:500/112",
      "2606:4700:10::6816:600/112", "2606:4700:10::6816:700/112", "2606:4700:10::6816:800/112",
      "2606:4700:10::6816:900/112", "2606:4700:10::6816:a00/112", "2606:4700:10::6816:b00/112",
      "2606:4700:10::6816:c00/112", "2606:4700:10::6816:d00/112", "2606:4700:10::6816:e00/112",
      "2606:4700:10::6816:f00/112", "2606:4700:10::6816:1000/112", "2606:4700:10::6816:1100/112",
      "2606:4700:10::6816:1200/112", "2606:4700:10::6816:1300/112", "2606:4700:10::6816:1400/112"
    ];
  </script>
  
  <!-- å¼•å…¥æµ‹é€Ÿè„šæœ¬ -->
  <script src="js/ip-test-browser.js"></script>
  
  <!-- æ·»åŠ é¢å¤–çš„è‡ªå®šä¹‰åŠŸèƒ½ -->
  <script>
    // åœ¨é¡µé¢åŠ è½½å®Œæˆåæ·»åŠ ä½¿ç”¨è¯´æ˜å’Œä¸Šä¼ åŠŸèƒ½
    document.addEventListener('DOMContentLoaded', () => {
      // ä½¿ç”¨å†…è”IPåˆ—è¡¨ï¼Œè€Œä¸æ˜¯ä»æ–‡ä»¶åŠ è½½
      if (typeof ipv4List !== 'undefined') {
        ipv4List = INLINE_IPV4_LIST;
      }
      
      if (typeof ipv6List !== 'undefined') {
        ipv6List = INLINE_IPV6_LIST;
      }
      
      // ç»‘å®šæ ‡ç­¾åˆ‡æ¢äº‹ä»¶
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          
          tab.classList.add('active');
          document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
        });
      });
      
      // ç»‘å®šæ–‡ä»¶å¯¼å…¥äº‹ä»¶
      document.getElementById('uploadForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const fileInput = document.getElementById('ipFile');
        const uploadStatus = document.getElementById('uploadStatus');
        const uploadResults = document.getElementById('uploadResults');
        
        if (!fileInput.files || fileInput.files.length === 0) {
          uploadStatus.innerHTML = 'è¯·é€‰æ‹©æ–‡ä»¶';
          uploadStatus.className = 'upload-status error';
          return;
        }
        
        const file = fileInput.files[0];
        
        // è¯»å–æ–‡ä»¶å†…å®¹
        const reader = new FileReader();
        reader.onload = async (event) => {
          const content = event.target.result;
          
          // è§£æä¼˜é€‰IPæ–‡ä»¶
          try {
            uploadStatus.innerHTML = 'æ­£åœ¨å¤„ç†æ–‡ä»¶...';
            uploadStatus.className = 'upload-status';
            
            // è§£ææ–‡ä»¶å†…å®¹
            const lines = content.split('\n').filter(line => line.trim() !== '');
            const optimizedIPs = {};
            
            // åˆå§‹åŒ–æ‰€æœ‰åŒºåŸŸ
            if (typeof CONFIG !== 'undefined' && CONFIG.regions) {
              CONFIG.regions.forEach(region => {
                optimizedIPs[region.id] = [];
              });
            } else {
              // å¤‡ç”¨åˆå§‹åŒ–
              ['hk', 'jp', 'sg', 'us', 'tw', 'kr', 'de', 'uk', 'fr', 'ca', 'au', 'br'].forEach(id => {
                optimizedIPs[id] = [];
              });
            }
            
            let currentRegion = null;
            
            // è§£ææ–‡ä»¶å†…å®¹
            for (const line of lines) {
              // æ£€æŸ¥æ˜¯å¦æ˜¯åœ°åŒºæ ‡è®°è¡Œ
              if (line.startsWith('#')) {
                const lowerLine = line.toLowerCase();
                if (lowerLine.includes('hk') || lowerLine.includes('é¦™æ¸¯')) {
                  currentRegion = 'hk';
                } else if (lowerLine.includes('jp') || lowerLine.includes('æ—¥æœ¬')) {
                  currentRegion = 'jp';
                } else if (lowerLine.includes('us') || lowerLine.includes('ç¾å›½')) {
                  currentRegion = 'us';
                } else if (lowerLine.includes('sg') || lowerLine.includes('æ–°åŠ å¡')) {
                  currentRegion = 'sg';
                } else if (lowerLine.includes('tw') || lowerLine.includes('å°æ¹¾')) {
                  currentRegion = 'tw';
                } else if (lowerLine.includes('kr') || lowerLine.includes('éŸ©å›½')) {
                  currentRegion = 'kr';
                } else if (lowerLine.includes('de') || lowerLine.includes('å¾·å›½')) {
                  currentRegion = 'de';
                } else if (lowerLine.includes('uk') || lowerLine.includes('è‹±å›½')) {
                  currentRegion = 'uk';
                } else if (lowerLine.includes('fr') || lowerLine.includes('æ³•å›½')) {
                  currentRegion = 'fr';
                } else if (lowerLine.includes('ca') || lowerLine.includes('åŠ æ‹¿å¤§')) {
                  currentRegion = 'ca';
                } else if (lowerLine.includes('au') || lowerLine.includes('æ¾³å¤§åˆ©äºš')) {
                  currentRegion = 'au';
                } else if (lowerLine.includes('br') || lowerLine.includes('å·´è¥¿')) {
                  currentRegion = 'br';
                } else if (lowerLine.includes('asia') || lowerLine.includes('äºšæ´²')) {
                  currentRegion = 'hk'; // é»˜è®¤ä½¿ç”¨é¦™æ¸¯ä½œä¸ºäºšæ´²åŒºåŸŸ
                } else if (lowerLine.includes('europe') || lowerLine.includes('æ¬§æ´²')) {
                  currentRegion = 'de'; // é»˜è®¤ä½¿ç”¨å¾·å›½ä½œä¸ºæ¬§æ´²åŒºåŸŸ
                } else if (lowerLine.includes('america') || lowerLine.includes('ç¾æ´²')) {
                  currentRegion = 'us'; // é»˜è®¤ä½¿ç”¨ç¾å›½ä½œä¸ºç¾æ´²åŒºåŸŸ
                } else {
                  // å°è¯•åŒ¹é…ä»»ä½•åŒºåŸŸåç§°
                  for (const region of CONFIG.regions) {
                    if (lowerLine.includes(region.id) || lowerLine.includes(region.name.toLowerCase())) {
                      currentRegion = region.id;
                      break;
                    }
                  }
                }
              } 
              // å¦‚æœæ˜¯IPè¡Œï¼Œæå–IPåœ°å€
              else if (currentRegion && optimizedIPs[currentRegion]) {
                // æ”¯æŒæ–°çš„æ ¼å¼ï¼šIP:ç«¯å£ # å›½å®¶æˆ–åœ°åŒº
                // æˆ–è€…æ—§æ ¼å¼ï¼šIP # ç«¯å£ä¿¡æ¯
                const ipMatch = line.match(/^([0-9a-fA-F.:]+)(?::\d+)?/);
                if (ipMatch && ipMatch[1]) {
                  const ip = ipMatch[1].trim();
                  // ç¡®ä¿IPä¸é‡å¤
                  if (!optimizedIPs[currentRegion].includes(ip)) {
                    optimizedIPs[currentRegion].push(ip);
                  }
                }
              }
            }
            
            // ç¡®ä¿æ¯ä¸ªåŒºåŸŸè‡³å°‘æœ‰ä¸€ä¸ªIP
            const defaultIP = "104.16.25.4";
            for (const region in optimizedIPs) {
              if (optimizedIPs[region].length === 0) {
                optimizedIPs[region].push(defaultIP);
              }
            }
            
            // æ˜¾ç¤ºè§£æç»“æœ
            let html = '<h3>è§£æç»“æœ</h3>';
            
            // æŒ‰åœ°åŒºåˆ†ç»„æ˜¾ç¤º
            let regions;
            if (typeof CONFIG !== 'undefined' && CONFIG.regions) {
              regions = {};
              CONFIG.regions.forEach(region => {
                regions[region.id] = region.name;
              });
            } else {
              // å¤‡ç”¨åŒºåŸŸæ˜ å°„
              regions = {
                'hk': 'é¦™æ¸¯',
                'jp': 'æ—¥æœ¬',
                'us': 'ç¾å›½',
                'sg': 'æ–°åŠ å¡',
                'tw': 'å°æ¹¾',
                'kr': 'éŸ©å›½',
                'de': 'å¾·å›½',
                'uk': 'è‹±å›½',
                'fr': 'æ³•å›½',
                'ca': 'åŠ æ‹¿å¤§',
                'au': 'æ¾³å¤§åˆ©äºš'
              };
            }
            
            // æŒ‰å¤§åŒºåˆ†ç»„æ˜¾ç¤º
            const regionsByArea = {};
            if (typeof CONFIG !== 'undefined' && CONFIG.regions) {
              CONFIG.regions.forEach(region => {
                if (!regionsByArea[region.region]) {
                  regionsByArea[region.region] = [];
                }
                regionsByArea[region.region].push(region.id);
              });
            } else {
              // å¤‡ç”¨åˆ†ç»„
              regionsByArea['äºšæ´²'] = ['hk', 'jp', 'sg', 'tw', 'kr'];
              regionsByArea['åŒ—ç¾'] = ['us', 'ca'];
              regionsByArea['æ¬§æ´²'] = ['uk', 'de', 'fr'];
              regionsByArea['å¤§æ´‹æ´²'] = ['au'];
            }
            
            // æŒ‰å¤§åŒºæ˜¾ç¤ºç»“æœ
            for (const [areaName, regionIds] of Object.entries(regionsByArea)) {
              html += `<h4>${areaName}</h4>`;
              
              for (const regionId of regionIds) {
                if (optimizedIPs[regionId] && optimizedIPs[regionId].length > 0) {
                  html += `<div class="region">
                    <h5>${regions[regionId] || regionId} ä¼˜é€‰IP</h5>
                    <ul>`;
                  
                  optimizedIPs[regionId].forEach(ip => {
                    html += `<li>${ip}</li>`;
                  });
                  
                  html += `</ul></div>`;
                }
              }
            }
            
            uploadResults.innerHTML = html;
            uploadStatus.innerHTML = 'è§£ææˆåŠŸï¼æ‚¨å¯ä»¥å°†è¿™äº›IPç”¨äºä»£ç†èŠ‚ç‚¹é…ç½®ã€‚';
            uploadStatus.className = 'upload-status success';
            
            // æ·»åŠ å¯¼å‡ºæŒ‰é’®
            const exportBtn = document.createElement('button');
            exportBtn.className = 'upload-btn';
            exportBtn.style.marginLeft = '10px';
            exportBtn.textContent = 'å¯¼å‡ºè§£æç»“æœ';
            exportBtn.addEventListener('click', () => {
              // åˆ›å»ºé€‰æ‹©å¯¹è¯æ¡†
              const exportDialog = document.createElement('div');
              exportDialog.style.position = 'fixed';
              exportDialog.style.top = '50%';
              exportDialog.style.left = '50%';
              exportDialog.style.transform = 'translate(-50%, -50%)';
              exportDialog.style.background = 'white';
              exportDialog.style.padding = '20px';
              exportDialog.style.borderRadius = '8px';
              exportDialog.style.boxShadow = '0 0 10px rgba(0,0,0,0.3)';
              exportDialog.style.zIndex = '1000';
              exportDialog.style.maxWidth = '600px';
              exportDialog.style.width = '90%';
              exportDialog.style.maxHeight = '80vh';
              exportDialog.style.overflowY = 'auto';
              
              // æ·»åŠ æ ‡é¢˜
              const title = document.createElement('h3');
              title.textContent = 'å¯¼å‡ºè®¾ç½®';
              title.style.marginTop = '0';
              exportDialog.appendChild(title);
              
              // åˆ›å»ºä¸¤åˆ—å¸ƒå±€
              const columnsDiv = document.createElement('div');
              columnsDiv.style.display = 'flex';
              columnsDiv.style.flexWrap = 'wrap';
              columnsDiv.style.gap = '20px';
              
              // === åœ°åŒºé€‰æ‹©éƒ¨åˆ† ===
              const regionColumn = document.createElement('div');
              regionColumn.style.flex = '1';
              regionColumn.style.minWidth = '250px';
              
              const regionTitle = document.createElement('h4');
              regionTitle.textContent = 'é€‰æ‹©åœ°åŒº';
              regionTitle.style.marginTop = '0';
              regionColumn.appendChild(regionTitle);
              
              // æ·»åŠ åœ°åŒºå…¨é€‰/å–æ¶ˆæŒ‰é’®
              const regionButtonsDiv = document.createElement('div');
              regionButtonsDiv.style.display = 'flex';
              regionButtonsDiv.style.gap = '10px';
              regionButtonsDiv.style.marginBottom = '10px';
              
              const selectAllRegionsBtn = document.createElement('button');
              selectAllRegionsBtn.textContent = 'å…¨é€‰åœ°åŒº';
              selectAllRegionsBtn.className = 'upload-btn';
              selectAllRegionsBtn.style.padding = '5px 10px';
              selectAllRegionsBtn.style.fontSize = '14px';
              
              const deselectAllRegionsBtn = document.createElement('button');
              deselectAllRegionsBtn.textContent = 'å–æ¶ˆå…¨é€‰';
              deselectAllRegionsBtn.className = 'upload-btn';
              deselectAllRegionsBtn.style.padding = '5px 10px';
              deselectAllRegionsBtn.style.background = '#ccc';
              
              regionButtonsDiv.appendChild(selectAllRegionsBtn);
              regionButtonsDiv.appendChild(deselectAllRegionsBtn);
              regionColumn.appendChild(regionButtonsDiv);
              
              // æ·»åŠ åœ°åŒºç­›é€‰æœç´¢æ¡†
              const regionSearchDiv = document.createElement('div');
              regionSearchDiv.style.marginBottom = '10px';
              
              const regionSearchInput = document.createElement('input');
              regionSearchInput.type = 'text';
              regionSearchInput.placeholder = 'æœç´¢åœ°åŒº...';
              regionSearchInput.style.width = '100%';
              regionSearchInput.style.padding = '5px';
              regionSearchInput.style.borderRadius = '4px';
              regionSearchInput.style.border = '1px solid #ddd';
              
              regionSearchDiv.appendChild(regionSearchInput);
              regionColumn.appendChild(regionSearchDiv);
              
              // åœ°åŒºé€‰æ‹©å®¹å™¨
              const regionsDiv = document.createElement('div');
              regionsDiv.style.maxHeight = '300px';
              regionsDiv.style.overflowY = 'auto';
              regionsDiv.style.border = '1px solid #eee';
              regionsDiv.style.padding = '10px';
              regionsDiv.style.borderRadius = '4px';
              
              // æŒ‰å¤§åŒºåˆ†ç»„æ˜¾ç¤ºåœ°åŒº
              for (const [areaName, regionIds] of Object.entries(regionsByArea)) {
                const areaDiv = document.createElement('div');
                areaDiv.style.marginBottom = '15px';
                
                const areaTitle = document.createElement('h5');
                areaTitle.textContent = areaName;
                areaTitle.style.margin = '0 0 5px 0';
                areaTitle.style.borderBottom = '1px solid #eee';
                areaTitle.style.paddingBottom = '3px';
                areaDiv.appendChild(areaTitle);
                
                const regionsInAreaDiv = document.createElement('div');
                regionsInAreaDiv.style.display = 'flex';
                regionsInAreaDiv.style.flexWrap = 'wrap';
                regionsInAreaDiv.style.gap = '5px';
                
                regionIds.forEach(regionId => {
                  const regionName = regions[regionId] || regionId;
                  
                  const regionLabel = document.createElement('label');
                  regionLabel.style.display = 'flex';
                  regionLabel.style.alignItems = 'center';
                  regionLabel.style.margin = '3px 10px 3px 0';
                  regionLabel.style.width = 'calc(50% - 10px)';
                  regionLabel.className = 'export-region-option';
                  regionLabel.dataset.region = regionId;
                  regionLabel.dataset.name = regionName;
                  
                  const regionCheck = document.createElement('input');
                  regionCheck.type = 'checkbox';
                  regionCheck.value = regionId;
                  regionCheck.className = 'export-region-checkbox';
                  regionCheck.checked = true; // é»˜è®¤é€‰ä¸­æ‰€æœ‰åœ°åŒº
                  regionCheck.style.marginRight = '5px';
                  
                  regionLabel.appendChild(regionCheck);
                  regionLabel.appendChild(document.createTextNode(regionName));
                  regionsInAreaDiv.appendChild(regionLabel);
                });
                
                areaDiv.appendChild(regionsInAreaDiv);
                regionsDiv.appendChild(areaDiv);
              }
              
              regionColumn.appendChild(regionsDiv);
              columnsDiv.appendChild(regionColumn);
              
              // === ç«¯å£é€‰æ‹©éƒ¨åˆ† ===
              const portColumn = document.createElement('div');
              portColumn.style.flex = '1';
              portColumn.style.minWidth = '250px';
              
              const portTitle = document.createElement('h4');
              portTitle.textContent = 'é€‰æ‹©ç«¯å£';
              portTitle.style.marginTop = '0';
              portColumn.appendChild(portTitle);
              
              // æ·»åŠ ç«¯å£å…¨é€‰/å–æ¶ˆæŒ‰é’®
              const portButtonsDiv = document.createElement('div');
              portButtonsDiv.style.display = 'flex';
              portButtonsDiv.style.gap = '10px';
              portButtonsDiv.style.marginBottom = '10px';
              
              const selectAllPortsBtn = document.createElement('button');
              selectAllPortsBtn.textContent = 'å…¨é€‰ç«¯å£';
              selectAllPortsBtn.className = 'upload-btn';
              selectAllPortsBtn.style.padding = '5px 10px';
              selectAllPortsBtn.style.fontSize = '14px';
              
              const deselectAllPortsBtn = document.createElement('button');
              deselectAllPortsBtn.textContent = 'å–æ¶ˆå…¨é€‰';
              deselectAllPortsBtn.className = 'upload-btn';
              deselectAllPortsBtn.style.padding = '5px 10px';
              deselectAllPortsBtn.style.fontSize = '14px';
              deselectAllPortsBtn.style.background = '#ccc';
              
              portButtonsDiv.appendChild(selectAllPortsBtn);
              portButtonsDiv.appendChild(deselectAllPortsBtn);
              portColumn.appendChild(portButtonsDiv);
              
              // æ·»åŠ ç«¯å£é€‰æ‹©å®¹å™¨
              const portsDiv = document.createElement('div');
              portsDiv.style.maxHeight = '300px';
              portsDiv.style.overflowY = 'auto';
              portsDiv.style.border = '1px solid #eee';
              portsDiv.style.padding = '10px';
              portsDiv.style.borderRadius = '4px';
              
              // å®šä¹‰å¯é€‰ç«¯å£
              const availablePorts = [
                {port: '80', group: '80ç³»', default: true},
                {port: '8080', group: '80ç³»', default: true},
                {port: '8880', group: '80ç³»', default: true},
                {port: '2052', group: '80ç³»', default: true},
                {port: '2082', group: '80ç³»', default: true},
                {port: '2086', group: '80ç³»', default: true},
                {port: '2095', group: '80ç³»', default: true},
                {port: '443', group: '443ç³»', default: true},
                {port: '2053', group: '443ç³»', default: true},
                {port: '2083', group: '443ç³»', default: true},
                {port: '2087', group: '443ç³»', default: true},
                {port: '2096', group: '443ç³»', default: true},
                {port: '8443', group: '443ç³»', default: true}
              ];
              
              // æŒ‰ç»„åˆ†ç±»ç«¯å£
              const portGroups = {};
              availablePorts.forEach(portInfo => {
                if (!portGroups[portInfo.group]) {
                  portGroups[portInfo.group] = [];
                }
                portGroups[portInfo.group].push(portInfo);
              });
              
              // åˆ›å»ºç«¯å£é€‰æ‹©UI
              Object.entries(portGroups).forEach(([group, ports]) => {
                const groupDiv = document.createElement('div');
                groupDiv.style.marginBottom = '15px';
                
                const groupTitle = document.createElement('h5');
                groupTitle.textContent = group;
                groupTitle.style.margin = '0 0 5px 0';
                groupTitle.style.borderBottom = '1px solid #eee';
                groupTitle.style.paddingBottom = '3px';
                groupDiv.appendChild(groupTitle);
                
                const portsInGroupDiv = document.createElement('div');
                portsInGroupDiv.style.display = 'flex';
                portsInGroupDiv.style.flexWrap = 'wrap';
                portsInGroupDiv.style.gap = '5px';
                
                ports.forEach(portInfo => {
                  const portLabel = document.createElement('label');
                  portLabel.style.display = 'flex';
                  portLabel.style.alignItems = 'center';
                  portLabel.style.margin = '3px 10px 3px 0';
                  portLabel.style.width = 'calc(50% - 10px)';
                  
                  const portCheck = document.createElement('input');
                  portCheck.type = 'checkbox';
                  portCheck.value = portInfo.port;
                  portCheck.className = 'export-port-checkbox';
                  portCheck.checked = portInfo.default || true; // é»˜è®¤å…¨é€‰
                  portCheck.style.marginRight = '5px';
                  
                  portLabel.appendChild(portCheck);
                  portLabel.appendChild(document.createTextNode(portInfo.port));
                  portsInGroupDiv.appendChild(portLabel);
                });
                
                groupDiv.appendChild(portsInGroupDiv);
                portsDiv.appendChild(groupDiv);
              });
              
              portColumn.appendChild(portsDiv);
              columnsDiv.appendChild(portColumn);
              exportDialog.appendChild(columnsDiv);
              
              // æ·»åŠ æŒ‰é’®
              const buttonDiv = document.createElement('div');
              buttonDiv.style.display = 'flex';
              buttonDiv.style.justifyContent = 'flex-end';
              buttonDiv.style.gap = '10px';
              buttonDiv.style.marginTop = '20px';
              
              const cancelBtn = document.createElement('button');
              cancelBtn.textContent = 'å–æ¶ˆ';
              cancelBtn.className = 'upload-btn';
              cancelBtn.style.background = '#ccc';
              cancelBtn.addEventListener('click', () => {
                document.body.removeChild(exportDialog);
                document.body.removeChild(overlay);
              });
              
              const confirmBtn = document.createElement('button');
              confirmBtn.textContent = 'å¯¼å‡º';
              confirmBtn.className = 'upload-btn';
              confirmBtn.addEventListener('click', () => {
                // è·å–é€‰ä¸­çš„ç«¯å£
                const selectedPorts = [];
                exportDialog.querySelectorAll('.export-port-checkbox:checked').forEach(checkbox => {
                  selectedPorts.push(checkbox.value);
                });
                
                // è·å–é€‰ä¸­çš„åœ°åŒº
                const selectedRegionIds = [];
                exportDialog.querySelectorAll('.export-region-checkbox:checked').forEach(checkbox => {
                  selectedRegionIds.push(checkbox.value);
                });
                
                // å¦‚æœæ²¡æœ‰é€‰æ‹©ç«¯å£ï¼Œé»˜è®¤ä½¿ç”¨443
                if (selectedPorts.length === 0) {
                  selectedPorts.push('443');
                }
                
                // å¦‚æœæ²¡æœ‰é€‰æ‹©åœ°åŒºï¼Œæç¤ºç”¨æˆ·
                if (selectedRegionIds.length === 0) {
                  alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªåœ°åŒº');
                  return;
                }
                
                // ç”Ÿæˆå¯¼å‡ºå†…å®¹
                let exportContent = '';
                
                // æŒ‰å¤§åŒºåˆ†ç»„å¯¼å‡º
                for (const [areaName, regionIds] of Object.entries(regionsByArea)) {
                  // è¿‡æ»¤å‡ºé€‰ä¸­çš„åœ°åŒº
                  const selectedRegions = regionIds.filter(id => selectedRegionIds.includes(id));
                  
                  if (selectedRegions.length === 0) continue; // å¦‚æœè¯¥å¤§åŒºæ²¡æœ‰é€‰ä¸­çš„åœ°åŒºï¼Œè·³è¿‡
                  
                  exportContent += `# ====== ${areaName} ======\n\n`;
                  
                  for (const regionId of selectedRegions) {
                    if (optimizedIPs[regionId] && optimizedIPs[regionId].length > 0) {
                      exportContent += `# ${regions[regionId] || regionId} åœ°åŒº\n`;
                      optimizedIPs[regionId].forEach(ip => {
                        // ä¸ºæ¯ä¸ªé€‰ä¸­çš„ç«¯å£ç”Ÿæˆä¸€è¡Œ
                        selectedPorts.forEach(port => {
                          exportContent += `${ip}:${port}#${regions[regionId] || regionId}\n`;
                        });
                      });
                      exportContent += '\n';
                    }
                  }
                }
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const blob = new Blob([exportContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'cloudflare-optimized-ips.txt';
                a.click();
                URL.revokeObjectURL(url);
                
                // å…³é—­å¯¹è¯æ¡†
                document.body.removeChild(exportDialog);
                document.body.removeChild(overlay);
              });
              
              buttonDiv.appendChild(cancelBtn);
              buttonDiv.appendChild(confirmBtn);
              exportDialog.appendChild(buttonDiv);
              
              // ç»‘å®šåœ°åŒºæœç´¢åŠŸèƒ½
              regionSearchInput.addEventListener('input', function() {
                const searchText = this.value.toLowerCase();
                exportDialog.querySelectorAll('.export-region-option').forEach(option => {
                  const regionName = option.dataset.name.toLowerCase();
                  const regionId = option.dataset.region.toLowerCase();
                  
                  if (searchText === '' || regionName.includes(searchText) || regionId.includes(searchText)) {
                    option.style.display = '';
                  } else {
                    option.style.display = 'none';
                  }
                });
              });
              
              // ç»‘å®šåœ°åŒºå…¨é€‰/å–æ¶ˆæŒ‰é’®
              selectAllRegionsBtn.addEventListener('click', () => {
                exportDialog.querySelectorAll('.export-region-checkbox').forEach(checkbox => {
                  checkbox.checked = true;
                });
              });
              
              deselectAllRegionsBtn.addEventListener('click', () => {
                exportDialog.querySelectorAll('.export-region-checkbox').forEach(checkbox => {
                  checkbox.checked = false;
                });
              });
              
              // ç»‘å®šç«¯å£å…¨é€‰/å–æ¶ˆæŒ‰é’®
              selectAllPortsBtn.addEventListener('click', () => {
                exportDialog.querySelectorAll('.export-port-checkbox').forEach(checkbox => {
                  checkbox.checked = true;
                });
              });
              
              deselectAllPortsBtn.addEventListener('click', () => {
                exportDialog.querySelectorAll('.export-port-checkbox').forEach(checkbox => {
                  checkbox.checked = false;
                });
              });
              
              // æ·»åŠ é®ç½©å±‚
              const overlay = document.createElement('div');
              overlay.style.position = 'fixed';
              overlay.style.top = '0';
              overlay.style.left = '0';
              overlay.style.width = '100%';
              overlay.style.height = '100%';
              overlay.style.background = 'rgba(0,0,0,0.5)';
              overlay.style.zIndex = '999';
              
              // æ·»åŠ åˆ°é¡µé¢
              document.body.appendChild(overlay);
              document.body.appendChild(exportDialog);
            });
            
            // æ·»åŠ æŒ‰é’®åˆ°çŠ¶æ€åŒºåŸŸ
            uploadStatus.appendChild(exportBtn);
            
            // è‡ªåŠ¨å¼€å§‹æµ‹è¯•åŠŸèƒ½
            if (document.getElementById('auto-test').checked) {
              // å»¶è¿Ÿä¸€ç§’åè‡ªåŠ¨å¼€å§‹æµ‹è¯•ï¼Œç¡®ä¿IPåˆ—è¡¨å·²åŠ è½½
              setTimeout(() => {
                document.getElementById('start-test').click();
              }, 1000);
            }
          } catch (error) {
            uploadStatus.innerHTML = 'è§£ææ–‡ä»¶å¤±è´¥: ' + error.message;
            uploadStatus.className = 'upload-status error';
          }
        };
        
        reader.onerror = () => {
          uploadStatus.innerHTML = 'è¯»å–æ–‡ä»¶å¤±è´¥';
          uploadStatus.className = 'upload-status error';
        };
        
        reader.readAsText(file);
      });
    });
  </script>
</body>
</html> 